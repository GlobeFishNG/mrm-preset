/**
 * This file was automatically generated by \`yarn openapi:codegen\`.
 * DO NOT MODIFY IT MANUALLY. Instead, modify the source OpenAPI/Swagger YAML file,
 * and run \`yarn openapi:codegen\` to regenerate this file.
 */

 /* eslint-disable prefer-arrow/prefer-arrow-functions */
// ------- automatically generated code start ---------

import * as express from 'express';
import * as Joi from '@hapi/joi';
import { createHttpError, HttpErrorCode, traceSession } from '@ngiq/nodejs-common';
import * as processor from './<%= apiName %>.routerprocessor';

<%- bundledJoiStrings %>
export function router(): express.Router {
  const myRouter = express.Router();
  myRouter.use((_req, _res, next) => { 
    traceSession.setData('serviceCode', '<%= apiCode %>');
    next();
  });
<% paths.forEach((path) => { -%>
<% path.operations.forEach((operation) => { -%>
  myRouter.<%= operation.method %>('<%= path.uri %>', validate<%= operation.name %>, processor.process<%= operation.name %>());
<% }); -%>
<% }); -%>
  return myRouter;
}

<% paths.forEach((path) => { -%>
<% path.operations.forEach((operation) => { -%>
function validate<%= operation.name %>(
  req: express.Request,
  _res: express.Response,
  next: express.NextFunction): void {
  traceSession.setData('operationId', '<%= operation.operationCode %>');
<% for(let key in operation.validator) { -%>
  const <%= key %>ValidationResult: Joi.ValidationResult = <%= operation.validator[key] %>.validate(req.<%= key %>);
  if (<%= key %>ValidationResult.error) {
    return next(
      createHttpError(HttpErrorCode.BadRequest, `Invalid request:${<%= key %>ValidationResult.error.message}!`)

    );
  }
<% } -%>
  return next();
}
<% }); -%> 
<% }); -%>
// ------- automatically generated code stop ---------
/* eslint-enable prefer-arrow/prefer-arrow-functions */